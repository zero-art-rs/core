# Project M: маніфест

Бажані вимоги до месенджера:

- децентралізована структура: розподілена на основі p2p мережі або федеративна на основі [SimpleX] або подібного підходу
- підтримка різних типів клієнтів: мобільні та десктоп, а також консольний клієнт
- e2e шифрування в режимах user-to-user та user-to-group
- post-compromise та forward secrecy: компроментація ключів користувача дозволить криптоаналітику прочитати лише обмежену кількість повідомлень
  та не залишитись непоміченим при спробі активних дій від імені легального користувача
- підтримка великих груп (розміру від 10.000 учасників та більше) без великих затрат для користувача на основі протоколу [ART]
- підтримка великих каналів (груп де бродкастить лише один або декілька учасників)
- підтримка user-to-user чатів з криптографією на основі протоколу [Signal] (Double/Triple (PQ) Ratchet)
- потенційна постквантова стійкість криптографії в user-to-user та user-to-group чатах
- підтримка різних режимів [ідентичності] в групах, зокрема 
  - *capybara*: повністю анонімний режим (повідомлення приходять від повністю невідомого відправника)
  - *elephant*: режим з частковим відслідковуванням (повідомлення приходять від анонімного відправника, але з можливістю встановити ланцюжок минулих повідомлень)
  - *alligator*: режим з повною публічністю (повідомлення приходять від конкретного учасника чату)
  - потенційна deniability для перших двох режимів комунікації, тобто неможливістю довести будь кому поза групою що повідомлення прийшло від певного учасника
  - можливість користувача обирати різну ідентичність для різних груп
- розділення ролей користувачів в групах:
  - *observer* (може лише приймати повідомлення)
  - *owner* (власник, може виконувати все те ж що і admin, а також видаляти групу або змінювати її властивості)
  - *member* (учасник групи що може приймати і надсилати повідомлення)
  - *admin* (адміністратор що може видаляти повідомлення та додавати та видаляти учасників)
- захист груп від зловмисних інсайдерів, які хочуть порушити структуру групи (Sybil attack resilience)
- система модерації контенту в групах: на нодах адміністраторів можуть бути запущені розпізнавачі забороненого вмісту або спаму згідно політик застосування
  які автоматично видалятимуть такий контент та можливо його творців з групи

Можна виділити 2 підходи до релізації:

- повністю розподілений
- федеративний (2 hop onion like [SimpleX])

## Повністю розподілений

- ❌ Користувачі мають низькорівневі ідентифікатори в DHT таблицях для маршрутизації повідомлень між нодами мережі. В якості протоколу маршрутизації може використовуватись [gossipsub] 
  або аналоги. Таким чином анонімність в user-to-user комунікції залишається проблемним місцем такого підходу без застосування додаткових засобів, накшталт Onion-маршрутизації. Оскільки всі ноди
  мережі мають знати для кого слід доставити p2p повідомлення, вони з високою імовірністю зможуть побудувати соціальний граф.
- ✅ У випадку реалізації групових чатів за допомогою [ART] питання анонімності так гостро не стоїть, оскільки маршрутизація повідомлень для групи буде здійснюватись 
  звичайним бродкастом на всі вузли мережі, кожен вузол буде перевіряти чи перебуває він в групі призначення повідомлення та здійснювати спробу розшифрування, тобто
  за коректної реалізації треті сторони не отримають додаткової інформації про склад груп, оскільки комунікація буде виглядати як звичайний [gossipsub] траффік
- ✅ Стійкість мережі залежить лише від наявності достатньої кількості нод користувачів
- ❌ Потенційно висока латентність коли користувачів в мережі багато, залежить від обраного типу p2p комунікації, але загалом середня довжина шляху при передачі повідомлення 
  буде оцінюватись як $log N/log D$, де $N$ - кількість нод в мережі, $D$ - середній степінь вершини мережі як графу. Ця величина лінійно впливатиме на латентність

## Федеративний

Описані пункти враховують реалізацію подібну до [SimpleX]:

- ✅ Користувачі взагалі не мають ідентифікаторів, натомість кожна комунікація відбувається за домогою симплексної черги повідомлень на серверній ноді,
  яка виконує роль message-broker, при цьому ця нода обирається отримувачем повідомлень. Для передачі повідомлень в зворотньому напрямку 
  (для підтримки дуплексної комунікації) обирається інша черга повідомлень на ймовірно іншому сервері, при цьому комунікція user-txqueue та user-rxqueue 
  також зашифрована e2e з автентифікацією на основі ключів, які передаються out-of-band комунікацією (по суті при скануванні QR-коду або кліку посилання на підключення до чату)
- ✅ Можна реалізувати анонімність досить високого ступеня в user-to-user чатах, оскільки використання симплексних черг на нодах-релеєрах та проксуючих нод (для забезпечення 2-hop onion routing)
  робить задачу ідентифікації відправників та отримувачів для стороннього спостерігача-зловмисника досить складною на практиці, враховуючи той факт що для кожного
  user-to-user чату необхідно дві унікальних симплексних черги
- ❌ Комунікація в групах за такого підходу майже не буде відрізнятись від звичайних групових чатів в [Signal], коли кількість обмінів в групі зростає квадратично від розміру групи
  тобто кожен учасник шифрує на всіх інших окремо. Нажаль більш формального опису моделі груп розробники [SimpleX] не наводять. Імовірно можна спробувати імплементувати [ART], що є
  предметом окремого аналізу
- ❌ Стійкість мережі буде залежати від того чи активні серверні ноди релеєри
- ✅ Потенційно низька латентність передачі повідомлень, оскільки між 2 користувачами перебуває як правило 2 ноди-релеєри (1 меседж-брокер і 1 проксі) які мають бути доступними

## Сфера застосування

Можливі сфери застосування месенджера та яскраві приклади існуючих рішень:
- приватна комунікація user-to-user або user-to-group:
  - [Telegram] - хороший як продукт, але безпека дуже умовна, імплементують e2e шифрування варіації Нікалая Дурова **лише** для секретних чатів, за замовчуванням виключене (таваріщ майор підтвердить)
  - [WhatsApp] - мессенджер від Meta, протокол майже у всьому повторює [Signal]
  - [Signal] - один із найвпливовіших прикладів, свого роду трендсеттер розробки приватних месенджерів, його протокол визнається найркащим, на нього орієнтуються майже всі інші e2e encryption рішення,
    має недоліки, зокрема відсутність підтримки великих груп та надмірну консервативність розробників та спільноти (хоча це не завжди недолік)
- корпоративна комунікація:
  - [Matrix] - федеративне рішення для корпоративного шифрування, орієнтується як на комерційний так і goverment сектори: Bundeswehr та Wojsko Polskie запровадили його для unclassified комунікацій
  - [Wire] - централізоване корпоративне рішення на базі [MLS] (одні з творців), широко використовується корпоративним та державним сектором: BMW, Amnesty International, U.S. Air Force
- платформа для децентралізованої захищеної комунікації:
  - [Waku] - децентралізована "анонімна" платформа, на базі неї зроблений децентралізований "e2e" месенджер та криптогаманець [Status]
- e2e комунікація з високою анонімністю:
  - [SimpleX] - федеративний анонімний захищений месенджер. В технічному плані виконаний дуже круто і виглядає як найдовершеніше що є на ринку в плані безпеки. [Недолік] - незручно майже у всьому
    (баланс зручність-безпека викручений повністю вправо без компромісів), вагомий мінус що його автор Євгєній Побєрєзкін резидент UK (як і компанія) має невідомі джерела фінансування проекту
    і крайньо-праві погляди (антивакс, фанат Трампа+Маска, ну і русня звісно)
- децентралізована платформа для спілкування:
  - [nostr] - децентралізована платформа для комунікації, позиціонується як "замінник" Twitter, акцент саме на соціальність мережі, без належного рівня приватності

Підсумувавши та провівши аналіз існуючих на ринку рішень ми дійшли до висновку що:

- розробляти месенджер для корпоративного сегменту(бізнес, урядові установи) може бути спряженим із ризиками того що ця ніша по більшості зайнята іншими рішеннями ([Matrix]),
  тому запропонувати щось якісно нове важко, до того ж в корпоративних сегментах 
- викручувати баланс зручність безпека в сторону безпеки виглядає привабливо (як в [SimpleX]), але як правило це дуже нішеве рішення, яка підійде вузькому колу журналістів, сайферпанків, кримінальним елементам,
  урядовцям та шпигунам, воно не стане рішенням для широкого вжитку. Коректна безпечна реалізація має бути предметом незалежних аудитів і в загальному випадку є досить складною
- найбільш доцільним на наш погляд виглядає розробка платформи для соціальної комунікації (ідеологічно подібним до Twitter), але на децентралізованій основі без єдиного центру впливу із e2e шифруванням з потенційно
  великими спільнотами (групами), при цьому слід зробити акцент на прозорості, нецензурованості та демократичних інструментах для управління спільнотами

## [Дисклеймер]

Розробники досить часто не можуть коректно оцінити потребу ринку і відповідно сформулювати чіткі вимоги, все наведене в цьому документі є персональною думкою розробників,
звісно ж тут присутня доля engineering bias і тому не може сприйматись як настанова до конкретних дій

[Conditional encryption]: https://dl.acm.org/doi/pdf/10.1145/3658644.3690374
[SimpleX]: https://simplex.chat/docs/guide/readme.html
[Signal]: https://signal.org/docs/specifications/doubleratchet/
[Дисклеймер]: http://hintjens.com/blog:19/noredirect/true
[ART]: https://eprint.iacr.org/2017/666.pdf
[ідентичності]: https://github.com/distributed-lab/papers/blob/main/in-da-club/In_Da_Club.pdf
[gossipsub]: https://github.com/libp2p/specs/tree/master/pubsub/gossipsub
[Matrix]: https://spec.matrix.org/latest/
[Wire]: https://wire.com/en/
[Telegram]: https://core.telegram.org/mtproto
[WhatsApp]: https://www.whatsapp.com/security/WhatsApp-Security-Whitepaper.pdf
[Waku]: https://waku.org/about
[Session]: https://getsession.org/litepaper/pdf
[Недолік]: https://censor.net/ua/blogs/3525466/novyyi-super-zahyschenyyi-mesendjer-simplex-chat-perevagy-yi-nedoliky
[Побєрєзкін]: https://x.com/epoberezkin
[Status]: https://status.app/
[nostr]: https://github.com/nostr-protocol/nostr